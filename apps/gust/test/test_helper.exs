Application.ensure_all_started(:mox)
Mox.defmock(Gust.DAGLoaderMock, for: Gust.DAG.Loader)
Mox.defmock(Gust.FileMonitorMock, for: Gust.FileMonitor)
Mox.defmock(Gust.DAGParserMock, for: Gust.DAG.Parser)
Mox.defmock(Gust.DAGRunnerSupervisorMock, for: Gust.DAG.RunnerSupervisor)
Mox.defmock(Gust.DAGTaskRunnerSupervisorMock, for: Gust.DAG.TaskRunnerSupervisor)
Mox.defmock(Gust.DAGStageRunnerSupervisorMock, for: Gust.DAG.StageRunnerSupervisor)
Mox.defmock(Gust.DAGStageCoordinatorMock, for: Gust.DAG.StageCoordinator)
Mox.defmock(Gust.DAGCompilerMock, for: Gust.DAG.Compiler)
Mox.defmock(Gust.DAGLoggerMock, for: Gust.DAG.Logger)
Mox.defmock(Gust.DAGRunTriggerMock, for: Gust.DAG.Run.Trigger)
Mox.defmock(Gust.DAGTaskDelayerMock, for: Gust.DAG.TaskDelayer)
Mox.defmock(Gust.DBLockerMock, for: Gust.DBLocker)
Mox.defmock(Gust.RunClaimMock, for: Gust.Run.Claim)

Application.put_env(:gust, :dag_parser, Gust.DAGParserMock)
Application.put_env(:gust, :dag_compiler, Gust.DAGCompilerMock)
Application.put_env(:gust, :dag_loader, Gust.DAGLoaderMock)
Application.put_env(:gust, :file_monitor, Gust.FileMonitorMock)
Application.put_env(:gust, :dag_runner_supervisor, Gust.DAGRunnerSupervisorMock)
Application.put_env(:gust, :dag_stage_runner_supervisor, Gust.DAGStageRunnerSupervisorMock)
Application.put_env(:gust, :dag_task_runner_supervisor, Gust.DAGTaskRunnerSupervisorMock)
Application.put_env(:gust, :dag_stage_coordinator, Gust.DAGStageCoordinatorMock)
Application.put_env(:gust, :dag_logger, Gust.DAGLoggerMock)
Application.put_env(:gust, :dag_run_trigger, Gust.DAGRunTriggerMock)
Application.put_env(:gust, :dag_task_delayer, Gust.DAGTaskDelayerMock)
Application.put_env(:gust, :db_locker, Gust.DBLockerMock)
Application.put_env(:gust, :run_claim, Gust.RunClaimMock)

ExUnit.start()
Ecto.Adapters.SQL.Sandbox.mode(Gust.Repo, :manual)
